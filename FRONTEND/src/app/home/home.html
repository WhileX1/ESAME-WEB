<div class="subheader">
	<div class="filter-row">
		<div class="date-range">
			<label>Da <input type="date" [(ngModel)]="dateFrom" autocomplete="off" (change)="applyFilters()" /></label>
			<label>A <input type="date" [(ngModel)]="dateTo" autocomplete="off" (change)="applyFilters()" /></label>
		</div>

		<label class="price-label">Prezzo
			<select [(ngModel)]="priceOp" (change)="onPriceOpChange()">
				<option value="">--</option>
				<option value="<">&lt;</option>
				<option value=">">&gt;</option>
				<option value="=">=</option>
				<option value="range">Range</option>
			</select>
		</label>

		<div class="price-inputs">
			<input type="number" placeholder="Valore" [(ngModel)]="priceVal" autocomplete="off" (input)="applyFilters()" />
			<input type="number" placeholder="Valore" [(ngModel)]="priceValMax" autocomplete="off" (input)="applyFilters()" [disabled]="priceOp !== 'range'" />
		</div>

		<label>Categoria
			<select [(ngModel)]="categoria" (change)="applyFilters()">
				@for (c of categories; track c.value) {
					<option [value]="c.value">{{c.label}}</option>
				}
			</select>
		</label>

		<label>Ordinamento
			<select [(ngModel)]="ordinamento" (change)="applyFilters()">
				<option value="">--</option>
				<option value="asc">A â†’ Z</option>
				<option value="desc">Z â†’ A</option>
			</select>
		</label>

		<label class="search">
			<input type="search" placeholder="Cerca nome..." [(ngModel)]="ricerca" autocomplete="off" (input)="applyFilters()" />
		</label>

		<label class="checkbox">
			<input type="checkbox" [(ngModel)]="maggiorenni" (change)="applyFilters()" />
			Maggiorenni
		</label>

		<label class="checkbox">
			<input type="checkbox" [(ngModel)]="hasPassword" (change)="applyFilters()" />
			Password
		</label>

		<div class="actions">
			<button type="button" (click)="resetFilters()">Reset</button>
		</div>
	</div>
</div>

<div class="home-content">
	<!-- LOADING INDICATOR -->
	<div *ngIf="loading" class="loading">
		<p>Caricamento eventi...</p>
	</div>

	<!-- ERROR MESSAGE -->
	<div *ngIf="error && !loading" class="error">
		<p>{{ error }}</p>
	</div>

	<!-- EVENTS LIST -->
	<div *ngIf="!loading && eventi.length > 0" class="events-list">
		<h2>Risultati: {{ eventi.length }} eventi trovati</h2>
		<div class="event-card" *ngFor="let evento of eventi" (click)="openEventModal(evento.ID_EVENTO)">
			<h3>{{ evento.NOME_EVENTO }}</h3>
			<p class="description">{{ evento.DESCRIZIONE_EVENTO }}</p>
			<div class="event-details">
				<span class="date">ğŸ“… {{ evento.DATA_EVENTO }}</span>
				<span class="location">ğŸ“ {{ evento.INDIRIZZO_EVENTO }}</span>
				<span class="price" *ngIf="evento.COSTO">ğŸ’µ {{ evento.COSTO }}â‚¬</span>
				@for (cat of evento.CATEGORIE; track cat) {
					<span class="category">ğŸ·ï¸ {{ cat }}</span>
				}
				<span class="age-restriction" *ngIf="evento.CHECK_MAGGIORENNI">ğŸ” Maggiorenni</span>
				<span class="capacity" *ngIf="evento.MAX_PARTECIPANTI">ğŸ‘¥ Max: {{ evento.MAX_PARTECIPANTI }}</span>
				<span class="password" *ngIf="evento.PASSWORD_EVENTO">ğŸ” Password</span>
			</div>
		</div>
	</div>

	<!-- NO RESULTS -->
	<div *ngIf="!loading && !error && eventi.length === 0" class="no-results">
		<p>Nessun evento trovato. Prova a modificare i filtri.</p>
	</div>
</div>

<!-- SCROLL TO TOP BUTTON -->
<button class="scroll-to-top" (click)="scrollToTop()" *ngIf="showScrollButton" title="Torna in cima">
	â†‘
</button>

<!-- EVENT DETAIL MODAL -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeEventModal()">
	<div class="modal-content" (click)="$event.stopPropagation()">
		<!-- Close button -->
		<button class="modal-close" (click)="closeEventModal()" title="Chiudi">âœ•</button>

		<div class="modal-scroll">
			<!-- Modal body -->
			<div *ngIf="modalLoading" class="modal-loading">
				<p>Caricamento dettagli...</p>
			</div>

			<div *ngIf="modalError && !modalLoading" class="modal-error">
				<p>{{ modalError }}</p>
			</div>

			<div *ngIf="selectedEventDetail && !modalLoading" class="modal-body">
				<h2>{{ selectedEventDetail.NOME_EVENTO }}</h2>
				<p class="modal-description">{{ selectedEventDetail.DESCRIZIONE_EVENTO }}</p>

				<div class="modal-details">
					<div class="detail-row" *ngIf="selectedEventDetail.DATA_EVENTO">
						<span class="label">ğŸ“… Data:</span>
						<span class="value">{{ selectedEventDetail.DATA_EVENTO }}</span>
					</div>

					<div class="detail-row" *ngIf="selectedEventDetail.INDIRIZZO_EVENTO">
						<span class="label">ğŸ“ Indirizzo:</span>
						<span class="value">{{ selectedEventDetail.INDIRIZZO_EVENTO }}</span>
					</div>

					<div class="detail-row" *ngIf="selectedEventDetail.COSTO">
						<span class="label">ğŸ’µ Costo:</span>
						<span class="value">{{ selectedEventDetail.COSTO }}â‚¬</span>
					</div>

					<div class="detail-row" *ngIf="selectedEventDetail.MAX_PARTECIPANTI">
						<span class="label">ğŸ‘¥ Max Partecipanti:</span>
						<span class="value">{{ selectedEventDetail.MAX_PARTECIPANTI }}</span>
					</div>

					<div class="detail-row" *ngIf="selectedEventDetail.CHECK_MAGGIORENNI">
						<span class="label">ğŸ” Maggiorenni:</span>
						<span class="value">SÃ¬</span>
					</div>

					<div class="detail-row" *ngIf="selectedEventDetail.PASSWORD_EVENTO">
						<span class="label">ğŸ” Password:</span>
						<span class="value">SÃ¬ (Protetto)</span>
					</div>

					<div class="detail-row" *ngIf="selectedEventDetail.CATEGORIE && selectedEventDetail.CATEGORIE.length > 0">
						<span class="label">ğŸ·ï¸ Categorie:</span>
						<div class="categories-list">
							@for (cat of selectedEventDetail.CATEGORIE; track cat) {
								<span class="category-badge">{{ cat }}</span>
							}
						</div>
					</div>
				</div>

				<button class="btn btn-primary" (click)="closeEventModal()">Chiudi</button>
			</div>
		</div>
	</div>
</div>
